!function(e){const a=["",'a good move ("!")','a bad move ("?")','an excelent move ("!!")','a blunder ("??")','speculative move ("!?")','a doubtful or dubious move ("?!")',"forced move (all others lose quickly)","singular move (no reasonable alternatives)","worst move","drawish position","equal chances, quiet position","equal chances, active position","unclear position","White has a slight advantage","Black has a slight advantage","White has a moderate advantage","Black has a moderate advantage","White has a decisive advantage","Black has a decisive advantage","White has a crushing advantage (Black should resign)","Black has a crushing advantage (White should resign)","White is in zugzwang","Black is in zugzwang","White has a slight space advantage","Black has a slight space advantage","White has a moderate space advantage","Black has a moderate space advantage","White has a decisive space advantage","Black has a decisive space advantage","White has a slight time (development) advantage","Black has a slight time (development) advantage","White has a moderate time (development) advantage","Black has a moderate time (development) advantage","White has a decisive time (development) advantage","Black has a decisive time (development) advantage","White has the initiative","Black has the initiative","White has a lasting initiative","Black has a lasting initiative","White has the attack","Black has the attack","White has insufficient compensation for material deficit","Black has insufficient compensation for material deficit","White has sufficient compensation for material deficit","Black has sufficient compensation for material deficit","White has more than adequate compensation for material deficit","Black has more than adequate compensation for material deficit","White has a slight center control advantage","Black has a slight center control advantage","White has a moderate center control advantage","Black has a moderate center control advantage","White has a decisive center control advantage","Black has a decisive center control advantage","White has a slight kingside control advantage","Black has a slight kingside control advantage","White has a moderate kingside control advantage","Black has a moderate kingside control advantage","White has a decisive kingside control advantage","Black has a decisive kingside control advantage","White has a slight queenside control advantage","Black has a slight queenside control advantage","White has a moderate queenside control advantage","Black has a moderate queenside control advantage","White has a decisive queenside control advantage","Black has a decisive queenside control advantage","White has a vulnerable first rank","Black has a vulnerable first rank","White has a well protected first rank","Black has a well protected first rank","White has a poorly protected king","Black has a poorly protected king","White has a well protected king","Black has a well protected king","White has a poorly placed king","Black has a poorly placed king","White has a well placed king","Black has a well placed king","White has a very weak pawn structure","Black has a very weak pawn structure","White has a moderately weak pawn structure","Black has a moderately weak pawn structure","White has a moderately strong pawn structure","Black has a moderately strong pawn structure","White has a very strong pawn structure","Black has a very strong pawn structure","White has poor knight placement","Black has poor knight placement","White has good knight placement","Black has good knight placement","White has poor bishop placement","Black has poor bishop placement","White has good bishop placement","Black has good bishop placement","White has poor rook placement","Black has poor rook placement","White has good rook placement","Black has good rook placement","White has poor queen placement","Black has poor queen placement","White has good queen placement","Black has good queen placement","White has poor piece coordination","Black has poor piece coordination","White has good piece coordination","Black has good piece coordination","White has played the opening very poorly","Black has played the opening very poorly","White has played the opening poorly","Black has played the opening poorly","White has played the opening well","Black has played the opening well","White has played the opening very well","Black has played the opening very well","White has played the middlegame very poorly","Black has played the middlegame very poorly","White has played the middlegame poorly","Black has played the middlegame poorly","White has played the middlegame well","Black has played the middlegame well","White has played the middlegame very well","Black has played the middlegame very well","White has played the ending very poorly","Black has played the ending very poorly","White has played the ending poorly","Black has played the ending poorly","White has played the ending well","Black has played the ending well","White has played the ending very well","Black has played the ending very well","White has slight counterplay","Black has slight counterplay","White has moderate counterplay","Black has moderate counterplay","White has decisive counterplay","Black has decisive counterplay","White has moderate time control pressure","Black has moderate time control pressure","White has severe time control pressure","Black has severe time control pressure"],t=["","!","?","&#x203C","&#x2047","&#x2049;","&#x2048;"];function h(e){return e.replace(/ \$(\d+)/g,function(e,h){return m2=parseInt(h),m2<7?t[m2]:`<div class="annNAG">${a[m2]}</div>`})}const c={N:{a1:["c2","b3"],a2:["c1","c3","b4"],a3:["b1","c2","c4","b5"],a4:["b2","c3","c5","b6"],a5:["b3","c4","c6","b7"],a6:["b4","c5","c7","b8"],a7:["b5","c6","c8"],a8:["b6","c7"],b1:["d2","a3","c3"],b2:["d1","d3","a4","c4"],b3:["a1","c1","d2","d4","a5","c5"],b4:["a2","c2","d3","d5","a6","c6"],b5:["a3","c3","d4","d6","a7","c7"],b6:["a4","c4","d5","d7","a8","c8"],b7:["a5","c5","d6","d8"],b8:["a6","c6","d7"],c1:["a2","e2","b3","d3"],c2:["a1","e1","a3","e3","b4","d4"],c3:["b1","d1","a2","e2","a4","e4","b5","d5"],c4:["b2","d2","a3","e3","a5","e5","b6","d6"],c5:["b3","d3","a4","e4","a6","e6","b7","d7"],c6:["b4","d4","a5","e5","a7","e7","b8","d8"],c7:["b5","d5","a6","e6","a8","e8"],c8:["b6","d6","a7","e7"],d1:["b2","f2","c3","e3"],d2:["b1","f1","b3","f3","c4","e4"],d3:["c1","e1","b2","f2","b4","f4","c5","e5"],d4:["c2","e2","b3","f3","b5","f5","c6","e6"],d5:["c3","e3","b4","f4","b6","f6","c7","e7"],d6:["c4","e4","b5","f5","b7","f7","c8","e8"],d7:["c5","e5","b6","f6","b8","f8"],d8:["c6","e6","b7","f7"],e1:["c2","g2","d3","f3"],e2:["c1","g1","c3","g3","d4","f4"],e3:["d1","f1","c2","g2","c4","g4","d5","f5"],e4:["d2","f2","c3","g3","c5","g5","d6","f6"],e5:["d3","f3","c4","g4","c6","g6","d7","f7"],e6:["d4","f4","c5","g5","c7","g7","d8","f8"],e7:["d5","f5","c6","g6","c8","g8"],e8:["d6","f6","c7","g7"],f1:["d2","h2","e3","g3"],f2:["d1","h1","d3","h3","e4","g4"],f3:["e1","g1","d2","h2","d4","h4","e5","g5"],f4:["e2","g2","d3","h3","d5","h5","e6","g6"],f5:["e3","g3","d4","h4","d6","h6","e7","g7"],f6:["e4","g4","d5","h5","d7","h7","e8","g8"],f7:["e5","g5","d6","h6","d8","h8"],f8:["e6","g6","d7","h7"],g1:["e2","f3","h3"],g2:["e1","e3","f4","h4"],g3:["f1","h1","e2","e4","f5","h5"],g4:["f2","h2","e3","e5","f6","h6"],g5:["f3","h3","e4","e6","f7","h7"],g6:["f4","h4","e5","e7","f8","h8"],g7:["f5","h5","e6","e8"],g8:["f6","h6","e7"],h1:["f2","g3"],h2:["f1","f3","g4"],h3:["g1","f2","f4","g5"],h4:["g2","f3","f5","g6"],h5:["g3","f4","f6","g7"],h6:["g4","f5","f7","g8"],h7:["g5","f6","f8"],h8:["g6","f7"]},B:{a1:["b2","c3","d4","e5","f6","g7","h8"],a2:["b1","b3","c4","d5","e6","f7","g8"],a3:["b2","c1","b4","c5","d6","e7","f8"],a4:["b3","c2","d1","b5","c6","d7","e8"],a5:["b4","c3","d2","e1","b6","c7","d8"],a6:["b5","c4","d3","e2","f1","b7","c8"],a7:["b6","c5","d4","e3","f2","g1","b8"],a8:["b7","c6","d5","e4","f3","g2","h1"],b1:["a2","c2","d3","e4","f5","g6","h7"],b2:["a1","c1","a3","c3","d4","e5","f6","g7","h8"],b3:["a2","c2","d1","a4","c4","d5","e6","f7","g8"],b4:["a3","c3","d2","e1","a5","c5","d6","e7","f8"],b5:["a4","c4","d3","e2","f1","a6","c6","d7","e8"],b6:["a5","c5","d4","e3","f2","g1","a7","c7","d8"],b7:["a6","c6","d5","e4","f3","g2","h1","a8","c8"],b8:["a7","c7","d6","e5","f4","g3","h2"],c1:["b2","a3","d2","e3","f4","g5","h6"],c2:["b1","d1","b3","a4","d3","e4","f5","g6","h7"],c3:["b2","a1","d2","e1","b4","a5","d4","e5","f6","g7","h8"],c4:["b3","a2","d3","e2","f1","b5","a6","d5","e6","f7","g8"],c5:["b4","a3","d4","e3","f2","g1","b6","a7","d6","e7","f8"],c6:["b5","a4","d5","e4","f3","g2","h1","b7","a8","d7","e8"],c7:["b6","a5","d6","e5","f4","g3","h2","b8","d8"],c8:["b7","a6","d7","e6","f5","g4","h3"],d1:["c2","b3","a4","e2","f3","g4","h5"],d2:["c1","e1","c3","b4","a5","e3","f4","g5","h6"],d3:["c2","b1","e2","f1","c4","b5","a6","e4","f5","g6","h7"],d4:["c3","b2","a1","e3","f2","g1","c5","b6","a7","e5","f6","g7","h8"],d5:["c4","b3","a2","e4","f3","g2","h1","c6","b7","a8","e6","f7","g8"],d6:["c5","b4","a3","e5","f4","g3","h2","c7","b8","e7","f8"],d7:["c6","b5","a4","e6","f5","g4","h3","c8","e8"],d8:["c7","b6","a5","e7","f6","g5","h4"],e1:["d2","c3","b4","a5","f2","g3","h4"],e2:["d1","f1","d3","c4","b5","a6","f3","g4","h5"],e3:["d2","c1","f2","g1","d4","c5","b6","a7","f4","g5","h6"],e4:["d3","c2","b1","f3","g2","h1","d5","c6","b7","a8","f5","g6","h7"],e5:["d4","c3","b2","a1","f4","g3","h2","d6","c7","b8","f6","g7","h8"],e6:["d5","c4","b3","a2","f5","g4","h3","d7","c8","f7","g8"],e7:["d6","c5","b4","a3","f6","g5","h4","d8","f8"],e8:["d7","c6","b5","a4","f7","g6","h5"],f1:["e2","d3","c4","b5","a6","g2","h3"],f2:["e1","g1","e3","d4","c5","b6","a7","g3","h4"],f3:["e2","d1","g2","h1","e4","d5","c6","b7","a8","g4","h5"],f4:["e3","d2","c1","g3","h2","e5","d6","c7","b8","g5","h6"],f5:["e4","d3","c2","b1","g4","h3","e6","d7","c8","g6","h7"],f6:["e5","d4","c3","b2","a1","g5","h4","e7","d8","g7","h8"],f7:["e6","d5","c4","b3","a2","g6","h5","e8","g8"],f8:["e7","d6","c5","b4","a3","g7","h6"],g1:["f2","e3","d4","c5","b6","a7","h2"],g2:["f1","h1","f3","e4","d5","c6","b7","a8","h3"],g3:["f2","e1","h2","f4","e5","d6","c7","b8","h4"],g4:["f3","e2","d1","h3","f5","e6","d7","c8","h5"],g5:["f4","e3","d2","c1","h4","f6","e7","d8","h6"],g6:["f5","e4","d3","c2","b1","h5","f7","e8","h7"],g7:["f6","e5","d4","c3","b2","a1","h6","f8","h8"],g8:["f7","e6","d5","c4","b3","a2","h7"],h1:["g2","f3","e4","d5","c6","b7","a8"],h2:["g1","g3","f4","e5","d6","c7","b8"],h3:["g2","f1","g4","f5","e6","d7","c8"],h4:["g3","f2","e1","g5","f6","e7","d8"],h5:["g4","f3","e2","d1","g6","f7","e8"],h6:["g5","f4","e3","d2","c1","g7","f8"],h7:["g6","f5","e4","d3","c2","b1","g8"],h8:["g7","f6","e5","d4","c3","b2","a1"]},R:{a1:["b1","c1","d1","e1","f1","g1","h1","a2","a3","a4","a5","a6","a7","a8"],a2:["a1","b2","c2","d2","e2","f2","g2","h2","a3","a4","a5","a6","a7","a8"],a3:["a2","a1","b3","c3","d3","e3","f3","g3","h3","a4","a5","a6","a7","a8"],a4:["a3","a2","a1","b4","c4","d4","e4","f4","g4","h4","a5","a6","a7","a8"],a5:["a4","a3","a2","a1","b5","c5","d5","e5","f5","g5","h5","a6","a7","a8"],a6:["a5","a4","a3","a2","a1","b6","c6","d6","e6","f6","g6","h6","a7","a8"],a7:["a6","a5","a4","a3","a2","a1","b7","c7","d7","e7","f7","g7","h7","a8"],a8:["a7","a6","a5","a4","a3","a2","a1","b8","c8","d8","e8","f8","g8","h8"],b1:["a1","c1","d1","e1","f1","g1","h1","b2","b3","b4","b5","b6","b7","b8"],b2:["b1","a2","c2","d2","e2","f2","g2","h2","b3","b4","b5","b6","b7","b8"],b3:["b2","b1","a3","c3","d3","e3","f3","g3","h3","b4","b5","b6","b7","b8"],b4:["b3","b2","b1","a4","c4","d4","e4","f4","g4","h4","b5","b6","b7","b8"],b5:["b4","b3","b2","b1","a5","c5","d5","e5","f5","g5","h5","b6","b7","b8"],b6:["b5","b4","b3","b2","b1","a6","c6","d6","e6","f6","g6","h6","b7","b8"],b7:["b6","b5","b4","b3","b2","b1","a7","c7","d7","e7","f7","g7","h7","b8"],b8:["b7","b6","b5","b4","b3","b2","b1","a8","c8","d8","e8","f8","g8","h8"],c1:["b1","a1","d1","e1","f1","g1","h1","c2","c3","c4","c5","c6","c7","c8"],c2:["c1","b2","a2","d2","e2","f2","g2","h2","c3","c4","c5","c6","c7","c8"],c3:["c2","c1","b3","a3","d3","e3","f3","g3","h3","c4","c5","c6","c7","c8"],c4:["c3","c2","c1","b4","a4","d4","e4","f4","g4","h4","c5","c6","c7","c8"],c5:["c4","c3","c2","c1","b5","a5","d5","e5","f5","g5","h5","c6","c7","c8"],c6:["c5","c4","c3","c2","c1","b6","a6","d6","e6","f6","g6","h6","c7","c8"],c7:["c6","c5","c4","c3","c2","c1","b7","a7","d7","e7","f7","g7","h7","c8"],c8:["c7","c6","c5","c4","c3","c2","c1","b8","a8","d8","e8","f8","g8","h8"],d1:["c1","b1","a1","e1","f1","g1","h1","d2","d3","d4","d5","d6","d7","d8"],d2:["d1","c2","b2","a2","e2","f2","g2","h2","d3","d4","d5","d6","d7","d8"],d3:["d2","d1","c3","b3","a3","e3","f3","g3","h3","d4","d5","d6","d7","d8"],d4:["d3","d2","d1","c4","b4","a4","e4","f4","g4","h4","d5","d6","d7","d8"],d5:["d4","d3","d2","d1","c5","b5","a5","e5","f5","g5","h5","d6","d7","d8"],d6:["d5","d4","d3","d2","d1","c6","b6","a6","e6","f6","g6","h6","d7","d8"],d7:["d6","d5","d4","d3","d2","d1","c7","b7","a7","e7","f7","g7","h7","d8"],d8:["d7","d6","d5","d4","d3","d2","d1","c8","b8","a8","e8","f8","g8","h8"],e1:["d1","c1","b1","a1","f1","g1","h1","e2","e3","e4","e5","e6","e7","e8"],e2:["e1","d2","c2","b2","a2","f2","g2","h2","e3","e4","e5","e6","e7","e8"],e3:["e2","e1","d3","c3","b3","a3","f3","g3","h3","e4","e5","e6","e7","e8"],e4:["e3","e2","e1","d4","c4","b4","a4","f4","g4","h4","e5","e6","e7","e8"],e5:["e4","e3","e2","e1","d5","c5","b5","a5","f5","g5","h5","e6","e7","e8"],e6:["e5","e4","e3","e2","e1","d6","c6","b6","a6","f6","g6","h6","e7","e8"],e7:["e6","e5","e4","e3","e2","e1","d7","c7","b7","a7","f7","g7","h7","e8"],e8:["e7","e6","e5","e4","e3","e2","e1","d8","c8","b8","a8","f8","g8","h8"],f1:["e1","d1","c1","b1","a1","g1","h1","f2","f3","f4","f5","f6","f7","f8"],f2:["f1","e2","d2","c2","b2","a2","g2","h2","f3","f4","f5","f6","f7","f8"],f3:["f2","f1","e3","d3","c3","b3","a3","g3","h3","f4","f5","f6","f7","f8"],f4:["f3","f2","f1","e4","d4","c4","b4","a4","g4","h4","f5","f6","f7","f8"],f5:["f4","f3","f2","f1","e5","d5","c5","b5","a5","g5","h5","f6","f7","f8"],f6:["f5","f4","f3","f2","f1","e6","d6","c6","b6","a6","g6","h6","f7","f8"],f7:["f6","f5","f4","f3","f2","f1","e7","d7","c7","b7","a7","g7","h7","f8"],f8:["f7","f6","f5","f4","f3","f2","f1","e8","d8","c8","b8","a8","g8","h8"],g1:["f1","e1","d1","c1","b1","a1","h1","g2","g3","g4","g5","g6","g7","g8"],g2:["g1","f2","e2","d2","c2","b2","a2","h2","g3","g4","g5","g6","g7","g8"],g3:["g2","g1","f3","e3","d3","c3","b3","a3","h3","g4","g5","g6","g7","g8"],g4:["g3","g2","g1","f4","e4","d4","c4","b4","a4","h4","g5","g6","g7","g8"],g5:["g4","g3","g2","g1","f5","e5","d5","c5","b5","a5","h5","g6","g7","g8"],g6:["g5","g4","g3","g2","g1","f6","e6","d6","c6","b6","a6","h6","g7","g8"],g7:["g6","g5","g4","g3","g2","g1","f7","e7","d7","c7","b7","a7","h7","g8"],g8:["g7","g6","g5","g4","g3","g2","g1","f8","e8","d8","c8","b8","a8","h8"],h1:["g1","f1","e1","d1","c1","b1","a1","h2","h3","h4","h5","h6","h7","h8"],h2:["h1","g2","f2","e2","d2","c2","b2","a2","h3","h4","h5","h6","h7","h8"],h3:["h2","h1","g3","f3","e3","d3","c3","b3","a3","h4","h5","h6","h7","h8"],h4:["h3","h2","h1","g4","f4","e4","d4","c4","b4","a4","h5","h6","h7","h8"],h5:["h4","h3","h2","h1","g5","f5","e5","d5","c5","b5","a5","h6","h7","h8"],h6:["h5","h4","h3","h2","h1","g6","f6","e6","d6","c6","b6","a6","h7","h8"],h7:["h6","h5","h4","h3","h2","h1","g7","f7","e7","d7","c7","b7","a7","h8"],h8:["h7","h6","h5","h4","h3","h2","h1","g8","f8","e8","d8","c8","b8","a8"]},Q:{a1:["b1","c1","d1","e1","f1","g1","h1","a2","a3","a4","a5","a6","a7","a8","b2","c3","d4","e5","f6","g7","h8"],a2:["a1","b1","b2","c2","d2","e2","f2","g2","h2","a3","a4","a5","a6","a7","a8","b3","c4","d5","e6","f7","g8"],a3:["a2","a1","b2","c1","b3","c3","d3","e3","f3","g3","h3","a4","a5","a6","a7","a8","b4","c5","d6","e7","f8"],a4:["a3","a2","a1","b3","c2","d1","b4","c4","d4","e4","f4","g4","h4","a5","a6","a7","a8","b5","c6","d7","e8"],a5:["a4","a3","a2","a1","b4","c3","d2","e1","b5","c5","d5","e5","f5","g5","h5","a6","a7","a8","b6","c7","d8"],a6:["a5","a4","a3","a2","a1","b5","c4","d3","e2","f1","b6","c6","d6","e6","f6","g6","h6","a7","a8","b7","c8"],a7:["a6","a5","a4","a3","a2","a1","b6","c5","d4","e3","f2","g1","b7","c7","d7","e7","f7","g7","h7","a8","b8"],a8:["a7","a6","a5","a4","a3","a2","a1","b7","c6","d5","e4","f3","g2","h1","b8","c8","d8","e8","f8","g8","h8"],b1:["a1","c1","d1","e1","f1","g1","h1","a2","b2","b3","b4","b5","b6","b7","b8","c2","d3","e4","f5","g6","h7"],b2:["a1","b1","c1","a2","c2","d2","e2","f2","g2","h2","a3","b3","b4","b5","b6","b7","b8","c3","d4","e5","f6","g7","h8"],b3:["a2","b2","b1","c2","d1","a3","c3","d3","e3","f3","g3","h3","a4","b4","b5","b6","b7","b8","c4","d5","e6","f7","g8"],b4:["a3","b3","b2","b1","c3","d2","e1","a4","c4","d4","e4","f4","g4","h4","a5","b5","b6","b7","b8","c5","d6","e7","f8"],b5:["a4","b4","b3","b2","b1","c4","d3","e2","f1","a5","c5","d5","e5","f5","g5","h5","a6","b6","b7","b8","c6","d7","e8"],b6:["a5","b5","b4","b3","b2","b1","c5","d4","e3","f2","g1","a6","c6","d6","e6","f6","g6","h6","a7","b7","b8","c7","d8"],b7:["a6","b6","b5","b4","b3","b2","b1","c6","d5","e4","f3","g2","h1","a7","c7","d7","e7","f7","g7","h7","a8","b8","c8"],b8:["a7","b7","b6","b5","b4","b3","b2","b1","c7","d6","e5","f4","g3","h2","a8","c8","d8","e8","f8","g8","h8"],c1:["b1","a1","d1","e1","f1","g1","h1","b2","a3","c2","c3","c4","c5","c6","c7","c8","d2","e3","f4","g5","h6"],c2:["b1","c1","d1","b2","a2","d2","e2","f2","g2","h2","b3","a4","c3","c4","c5","c6","c7","c8","d3","e4","f5","g6","h7"],c3:["b2","a1","c2","c1","d2","e1","b3","a3","d3","e3","f3","g3","h3","b4","a5","c4","c5","c6","c7","c8","d4","e5","f6","g7","h8"],c4:["b3","a2","c3","c2","c1","d3","e2","f1","b4","a4","d4","e4","f4","g4","h4","b5","a6","c5","c6","c7","c8","d5","e6","f7","g8"],c5:["b4","a3","c4","c3","c2","c1","d4","e3","f2","g1","b5","a5","d5","e5","f5","g5","h5","b6","a7","c6","c7","c8","d6","e7","f8"],c6:["b5","a4","c5","c4","c3","c2","c1","d5","e4","f3","g2","h1","b6","a6","d6","e6","f6","g6","h6","b7","a8","c7","c8","d7","e8"],c7:["b6","a5","c6","c5","c4","c3","c2","c1","d6","e5","f4","g3","h2","b7","a7","d7","e7","f7","g7","h7","b8","c8","d8"],c8:["b7","a6","c7","c6","c5","c4","c3","c2","c1","d7","e6","f5","g4","h3","b8","a8","d8","e8","f8","g8","h8"],d1:["c1","b1","a1","e1","f1","g1","h1","c2","b3","a4","d2","d3","d4","d5","d6","d7","d8","e2","f3","g4","h5"],d2:["c1","d1","e1","c2","b2","a2","e2","f2","g2","h2","c3","b4","a5","d3","d4","d5","d6","d7","d8","e3","f4","g5","h6"],d3:["c2","b1","d2","d1","e2","f1","c3","b3","a3","e3","f3","g3","h3","c4","b5","a6","d4","d5","d6","d7","d8","e4","f5","g6","h7"],d4:["c3","b2","a1","d3","d2","d1","e3","f2","g1","c4","b4","a4","e4","f4","g4","h4","c5","b6","a7","d5","d6","d7","d8","e5","f6","g7","h8"],d5:["c4","b3","a2","d4","d3","d2","d1","e4","f3","g2","h1","c5","b5","a5","e5","f5","g5","h5","c6","b7","a8","d6","d7","d8","e6","f7","g8"],d6:["c5","b4","a3","d5","d4","d3","d2","d1","e5","f4","g3","h2","c6","b6","a6","e6","f6","g6","h6","c7","b8","d7","d8","e7","f8"],d7:["c6","b5","a4","d6","d5","d4","d3","d2","d1","e6","f5","g4","h3","c7","b7","a7","e7","f7","g7","h7","c8","d8","e8"],d8:["c7","b6","a5","d7","d6","d5","d4","d3","d2","d1","e7","f6","g5","h4","c8","b8","a8","e8","f8","g8","h8"],e1:["d1","c1","b1","a1","f1","g1","h1","d2","c3","b4","a5","e2","e3","e4","e5","e6","e7","e8","f2","g3","h4"],e2:["d1","e1","f1","d2","c2","b2","a2","f2","g2","h2","d3","c4","b5","a6","e3","e4","e5","e6","e7","e8","f3","g4","h5"],e3:["d2","c1","e2","e1","f2","g1","d3","c3","b3","a3","f3","g3","h3","d4","c5","b6","a7","e4","e5","e6","e7","e8","f4","g5","h6"],e4:["d3","c2","b1","e3","e2","e1","f3","g2","h1","d4","c4","b4","a4","f4","g4","h4","d5","c6","b7","a8","e5","e6","e7","e8","f5","g6","h7"],e5:["d4","c3","b2","a1","e4","e3","e2","e1","f4","g3","h2","d5","c5","b5","a5","f5","g5","h5","d6","c7","b8","e6","e7","e8","f6","g7","h8"],e6:["d5","c4","b3","a2","e5","e4","e3","e2","e1","f5","g4","h3","d6","c6","b6","a6","f6","g6","h6","d7","c8","e7","e8","f7","g8"],e7:["d6","c5","b4","a3","e6","e5","e4","e3","e2","e1","f6","g5","h4","d7","c7","b7","a7","f7","g7","h7","d8","e8","f8"],e8:["d7","c6","b5","a4","e7","e6","e5","e4","e3","e2","e1","f7","g6","h5","d8","c8","b8","a8","f8","g8","h8"],f1:["e1","d1","c1","b1","a1","g1","h1","e2","d3","c4","b5","a6","f2","f3","f4","f5","f6","f7","f8","g2","h3"],f2:["e1","f1","g1","e2","d2","c2","b2","a2","g2","h2","e3","d4","c5","b6","a7","f3","f4","f5","f6","f7","f8","g3","h4"],f3:["e2","d1","f2","f1","g2","h1","e3","d3","c3","b3","a3","g3","h3","e4","d5","c6","b7","a8","f4","f5","f6","f7","f8","g4","h5"],f4:["e3","d2","c1","f3","f2","f1","g3","h2","e4","d4","c4","b4","a4","g4","h4","e5","d6","c7","b8","f5","f6","f7","f8","g5","h6"],f5:["e4","d3","c2","b1","f4","f3","f2","f1","g4","h3","e5","d5","c5","b5","a5","g5","h5","e6","d7","c8","f6","f7","f8","g6","h7"],f6:["e5","d4","c3","b2","a1","f5","f4","f3","f2","f1","g5","h4","e6","d6","c6","b6","a6","g6","h6","e7","d8","f7","f8","g7","h8"],f7:["e6","d5","c4","b3","a2","f6","f5","f4","f3","f2","f1","g6","h5","e7","d7","c7","b7","a7","g7","h7","e8","f8","g8"],f8:["e7","d6","c5","b4","a3","f7","f6","f5","f4","f3","f2","f1","g7","h6","e8","d8","c8","b8","a8","g8","h8"],g1:["f1","e1","d1","c1","b1","a1","h1","f2","e3","d4","c5","b6","a7","g2","g3","g4","g5","g6","g7","g8","h2"],g2:["f1","g1","h1","f2","e2","d2","c2","b2","a2","h2","f3","e4","d5","c6","b7","a8","g3","g4","g5","g6","g7","g8","h3"],g3:["f2","e1","g2","g1","h2","f3","e3","d3","c3","b3","a3","h3","f4","e5","d6","c7","b8","g4","g5","g6","g7","g8","h4"],g4:["f3","e2","d1","g3","g2","g1","h3","f4","e4","d4","c4","b4","a4","h4","f5","e6","d7","c8","g5","g6","g7","g8","h5"],g5:["f4","e3","d2","c1","g4","g3","g2","g1","h4","f5","e5","d5","c5","b5","a5","h5","f6","e7","d8","g6","g7","g8","h6"],g6:["f5","e4","d3","c2","b1","g5","g4","g3","g2","g1","h5","f6","e6","d6","c6","b6","a6","h6","f7","e8","g7","g8","h7"],g7:["f6","e5","d4","c3","b2","a1","g6","g5","g4","g3","g2","g1","h6","f7","e7","d7","c7","b7","a7","h7","f8","g8","h8"],g8:["f7","e6","d5","c4","b3","a2","g7","g6","g5","g4","g3","g2","g1","h7","f8","e8","d8","c8","b8","a8","h8"],h1:["g1","f1","e1","d1","c1","b1","a1","g2","f3","e4","d5","c6","b7","a8","h2","h3","h4","h5","h6","h7","h8"],h2:["g1","h1","g2","f2","e2","d2","c2","b2","a2","g3","f4","e5","d6","c7","b8","h3","h4","h5","h6","h7","h8"],h3:["g2","f1","h2","h1","g3","f3","e3","d3","c3","b3","a3","g4","f5","e6","d7","c8","h4","h5","h6","h7","h8"],h4:["g3","f2","e1","h3","h2","h1","g4","f4","e4","d4","c4","b4","a4","g5","f6","e7","d8","h5","h6","h7","h8"],h5:["g4","f3","e2","d1","h4","h3","h2","h1","g5","f5","e5","d5","c5","b5","a5","g6","f7","e8","h6","h7","h8"],h6:["g5","f4","e3","d2","c1","h5","h4","h3","h2","h1","g6","f6","e6","d6","c6","b6","a6","g7","f8","h7","h8"],h7:["g6","f5","e4","d3","c2","b1","h6","h5","h4","h3","h2","h1","g7","f7","e7","d7","c7","b7","a7","g8","h8"],h8:["g7","f6","e5","d4","c3","b2","a1","h7","h6","h5","h4","h3","h2","h1","g8","f8","e8","d8","c8","b8","a8"]},K:{a1:["b1","a2","b2"],a2:["a1","b1","b2","a3","b3"],a3:["a2","b2","b3","a4","b4"],a4:["a3","b3","b4","a5","b5"],a5:["a4","b4","b5","a6","b6"],a6:["a5","b5","b6","a7","b7"],a7:["a6","b6","b7","a8","b8"],a8:["a7","b7","b8"],b1:["a1","c1","a2","b2","c2"],b2:["a1","b1","c1","a2","c2","a3","b3","c3"],b3:["a2","b2","c2","a3","c3","a4","b4","c4"],b4:["a3","b3","c3","a4","c4","a5","b5","c5"],b5:["a4","b4","c4","a5","c5","a6","b6","c6"],b6:["a5","b5","c5","a6","c6","a7","b7","c7"],b7:["a6","b6","c6","a7","c7","a8","b8","c8"],b8:["a7","b7","c7","a8","c8"],c1:["b1","d1","b2","c2","d2"],c2:["b1","c1","d1","b2","d2","b3","c3","d3"],c3:["b2","c2","d2","b3","d3","b4","c4","d4"],c4:["b3","c3","d3","b4","d4","b5","c5","d5"],c5:["b4","c4","d4","b5","d5","b6","c6","d6"],c6:["b5","c5","d5","b6","d6","b7","c7","d7"],c7:["b6","c6","d6","b7","d7","b8","c8","d8"],c8:["b7","c7","d7","b8","d8"],d1:["c1","e1","c2","d2","e2"],d2:["c1","d1","e1","c2","e2","c3","d3","e3"],d3:["c2","d2","e2","c3","e3","c4","d4","e4"],d4:["c3","d3","e3","c4","e4","c5","d5","e5"],d5:["c4","d4","e4","c5","e5","c6","d6","e6"],d6:["c5","d5","e5","c6","e6","c7","d7","e7"],d7:["c6","d6","e6","c7","e7","c8","d8","e8"],d8:["c7","d7","e7","c8","e8"],e1:["d1","f1","d2","e2","f2"],e2:["d1","e1","f1","d2","f2","d3","e3","f3"],e3:["d2","e2","f2","d3","f3","d4","e4","f4"],e4:["d3","e3","f3","d4","f4","d5","e5","f5"],e5:["d4","e4","f4","d5","f5","d6","e6","f6"],e6:["d5","e5","f5","d6","f6","d7","e7","f7"],e7:["d6","e6","f6","d7","f7","d8","e8","f8"],e8:["d7","e7","f7","d8","f8"],f1:["e1","g1","e2","f2","g2"],f2:["e1","f1","g1","e2","g2","e3","f3","g3"],f3:["e2","f2","g2","e3","g3","e4","f4","g4"],f4:["e3","f3","g3","e4","g4","e5","f5","g5"],f5:["e4","f4","g4","e5","g5","e6","f6","g6"],f6:["e5","f5","g5","e6","g6","e7","f7","g7"],f7:["e6","f6","g6","e7","g7","e8","f8","g8"],f8:["e7","f7","g7","e8","g8"],g1:["f1","h1","f2","g2","h2"],g2:["f1","g1","h1","f2","h2","f3","g3","h3"],g3:["f2","g2","h2","f3","h3","f4","g4","h4"],g4:["f3","g3","h3","f4","h4","f5","g5","h5"],g5:["f4","g4","h4","f5","h5","f6","g6","h6"],g6:["f5","g5","h5","f6","h6","f7","g7","h7"],g7:["f6","g6","h6","f7","h7","f8","g8","h8"],g8:["f7","g7","h7","f8","h8"],h1:["g1","g2","h2"],h2:["g1","h1","g2","g3","h3"],h3:["g2","h2","g3","g4","h4"],h4:["g3","h3","g4","g5","h5"],h5:["g4","h4","g5","g6","h6"],h6:["g5","h5","g6","g7","h7"],h7:["g6","h6","g7","g8","h8"],h8:["g7","h7","g8"]}},s=[{a3:["a2","b2"],b3:["b2","a2","c2"],c3:["c2","b2","d2"],d3:["d2","c2","e2"],e3:["e2","d2","f2"],f3:["f2","e2","g2"],g3:["g2","f2","h2"],h3:["h2","g2"],a4:["a2","a3","b3"],b4:["b2","b3","a3","c3"],c4:["c2","c3","b3","d3"],d4:["d2","d3","c3","e3"],e4:["e2","e3","d3","f3"],f4:["f2","f3","e3","g3"],g4:["g2","g3","f3","h3"],h4:["h2","h3","g3"],a5:["a4","b4"],b5:["b4","a4","c4"],c5:["c4","b4","d4"],d5:["d4","c4","e4"],e5:["e4","d4","f4"],f5:["f4","e4","g4"],g5:["g4","f4","h4"],h5:["h4","g4"],a6:["a5","b5"],b6:["b5","a5","c5"],c6:["c5","b5","d5"],d6:["d5","c5","e5"],e6:["e5","d5","f5"],f6:["f5","e5","g5"],g6:["g5","f5","h5"],h6:["h5","g5"],a7:["a6","b6"],b7:["b6","a6","c6"],c7:["c6","b6","d6"],d7:["d6","c6","e6"],e7:["e6","d6","f6"],f7:["f6","e6","g6"],g7:["g6","f6","h6"],h7:["h6","g6"]},{a6:["a7","b7"],b6:["b7","a7","c7"],c6:["c7","b7","d7"],d6:["d7","c7","e7"],e6:["e7","d7","f7"],f6:["f7","e7","g7"],g6:["g7","f7","h7"],h6:["h7","g7"],a5:["a7","a6","b6"],b5:["b7","b6","a6","c6"],c5:["c7","c6","b6","d6"],d5:["d7","d6","c6","e6"],e5:["e7","e6","d6","f6"],f5:["f7","f6","e6","g6"],g5:["g7","g6","f6","h6"],h5:["h7","h6","g6"],a4:["a5","b5"],b4:["b5","a5","c5"],c4:["c5","b5","d5"],d4:["d5","c5","e5"],e4:["e5","d5","f5"],f4:["f5","e5","g5"],g4:["g5","f5","h5"],h4:["h5","g5"],a3:["a4","b4"],b3:["b4","a4","c4"],c3:["c4","b4","d4"],d3:["d4","c4","e4"],e3:["e4","d4","f4"],f3:["f4","e4","g4"],g3:["g4","f4","h4"],h3:["h4","g4"],a2:["a3","b3"],b2:["b3","a3","c3"],c2:["c3","b3","d3"],d2:["d3","c3","e3"],e2:["e3","d3","f3"],f2:["f3","e3","g3"],g2:["g3","f3","h3"],h2:["h3","g3"]}],d=[8,7,6,5,4,3,2,1],i=[1,2,3,4,5,6,7,8],f={p:"pawn",n:"knight",b:"bishop",r:"rook",q:"queen",k:"king"};const g=["Reverse","atBegin","atPrev","atNext","atEnd","AutoPlay"],n=["2B12","21A2","29CF","29D0","21A3","27F4","2B13"];function o(){this.SAN="",this.FEN="",this.mark="",this.NAG=0,this.variant=[],this.comment=""}const l={P:2,p:3,N:4,n:5,K:6,k:7,B:8,b:9,R:10,r:11,Q:12,q:13},b=[,,"P","p","N","n","K","k","B","b","R","r","Q","q"],r=[-16,-1,1,16],p=[-17,-15,15,17],v=[-17,-16,-15,-1,1,15,16,17],u=[-33,-31,-18,-14,14,18,31,33],m={6:[-17,-16,-15,-1,1,15,16,17],12:[-17,-16,-15,-1,1,15,16,17],10:[-16,-1,1,16],8:[-17,-15,15,17],4:[-33,-31,-18,-14,14,18,31,33]},k=e=>String.fromCharCode(97+(7&e))+(1+(e>>4)),_={a1:0,a2:16,a3:32,a4:48,a5:64,a6:80,a7:96,a8:112,b1:1,b2:17,b3:33,b4:49,b5:65,b6:81,b7:97,b8:113,c1:2,c2:18,c3:34,c4:50,c5:66,c6:82,c7:98,c8:114,d1:3,d2:19,d3:35,d4:51,d5:67,d6:83,d7:99,d8:115,e1:4,e2:20,e3:36,e4:52,e5:68,e6:84,e7:100,e8:116,f1:5,f2:21,f3:37,f4:53,f5:69,f6:85,f7:101,f8:117,g1:6,g2:22,g3:38,g4:54,g5:70,g6:86,g7:102,g8:118,h1:7,h2:23,h3:39,h4:55,h5:71,h6:87,h7:103,h8:119},B=/\[\w+\s+"[^\"]*"\]/g,M=/(\w+)\s+\"(.*)\"\]/,y=/1\/2\s*-\s*1\/2\s*$|0\s*-\s*1\s*$|1\s*-\s*0\s*|\*\s*$/,A=/^[KQRBN]?[a-h]?[1-8]?x?[a-h][1-8](?:\=?[QRBN])?/,w=/^O-O-O|^0-0-0|^O-O|^0-0/,$=/^[+|#|?|!]+/;function W(e,a,t){let h,c=1,s=0,d=e.length;for(h=1;h<d&c!=s;h++)switch(e.charAt(h)){case a:c++;break;case t:s++}return c==s?e.substring(1,h-1):""}function C(e){let a=e.match(/ [w|b] /),t=e.match(/\d+$/);return/w/.test(a)?t-1+"...":t+"."}e.widget("vb.pgnbrw",{options:{Load:!0,Game:!0,Moves:!1,Notes:!1,Child:!1,Men:24,Color:1},_create:function(){let a=this.element,t=this.options,h=this;(t.Notes||t.Child)&&(this.option("Moves",!0),this.option("Child",!t.Notes)),t.Load?(a.css({width:250,height:50}).show(),e("<button></button>").text("Load").css({position:"relative",left:"0.5em",top:"-1em"}).click(function(e){e.preventDefault(),h._init()}).insertAfter(a)):a.hide();let c=[t.Game?'<div class="GameInfo"></div>':"",'<div class="mGrid">','<div class="Grid1">','<div class="Men',t.Men,'">','<div class="Board FldColor',t.Color,'">','<div class="flds64">',function(){let e=[];for(let a of d)for(let t of i){let h=a+t&1?"whFld":"blFld";e.push(`<div class="Field Row${a} Col${t} ${h}"></div>`)}return e.join("")}(),"</div>",t.Moves&&function(e){let a=2+Number(e),t=[];e>23&&(e+=2);for(let e of i){let h=String.fromCharCode(96+e);t.push(`<div class='tagRow Row${e}' style='line-height:${a}px'>${e}</div><div class='tagCol Col${e}'>${h}</div>`)}return t.join("")}(t.Men)||"","<div class='Bkg' title='change color'>\n            <div class='Bkg1'></div><div class='Bkg2'></div>\n            <div class='Bkg3'></div></div>","</div>",function(){let e=["<div class='GameNav FldColor1'>"];e.push(`<div title='${g[0]}'>&#x${n[0]};</div>`);for(let a=1;a<6;a++)e.push(`<div class='whFld' title='${g[a]}'>&#x${n[a]};</div>`);return e.push("</div>"),e.join("")}(),"</div>","</div>",t.Moves?'<div class="Grid2"></div>':'<div class="Grid2" style="display:none"></div>',t.Notes?'<div class="Grid3"><div class="AnnLst"></div></div>':"",t.Child?'<div class="Grid3"><textarea></textarea></div>':"","</div>"],s=t.Load?a.next():a,f=e(c.join("")).insertAfter(s).children();this.pGame=t.Game?s.next().first():null,this.pMovLst=f.eq(1),this.pAnnLst=f.eq(2).find(".AnnLst"),this.pChild=f.eq(2);let o=f.eq(0);this.pFlds=o.find("div.flds64"),this.pBoard=this.pFlds.parent(),this.pNav=o.find("div.GameNav");let l=this.pBoard.find("div.Bkg");l.click(function(a){a.preventDefault();let t="FldColor"+(1+e(a.target).index()),h=l.parent();h.add(h.next()).removeClass("FldColor1 FldColor2 FldColor3").addClass(t)}),this.REVERSE=!1,this.brwtimer=0,this.pNav.click(function(a){a.preventDefault();let t=e(a.target);if(clearTimeout(h.brwtimer),t.attr("title"))switch(t.index()){case 1:h._firstMove();break;case 2:h._prevMove();break;case 3:h._nextMove();break;case 4:h._lastMove();break;case 5:h._auto_nextMove();break;case 0:h.REVERSE=!h.REVERSE,t.html(h.REVERSE?`&#x${n[6]};`:`&#x${n[0]};`),h.pBoard.toggleClass("revMB")}});let b=this.pBoard.height()+45;this.pMovLst.css("height",b),this.pAnnLst.css("height",b)},_init:function(){this.Tags={},this.Moves=[],this.LAST_POS_MOVE=null,this.in_comm="",this.errors="",this._extract_pgn(),this.FEN_initial=this.Tags.FEN||"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",this._setPosition(this.FEN_initial),this.x88Board=new Array(128),this.sq_king=[0,0],this._setBOARD(this.FEN_initial),this.bin_moves=[],this._setLinks(),this.Links=this.pMovLst.find("a"),this.pMovLst.on("click","a",a=>{a.preventDefault(),this._goToPos(e(a.target))}),this.pGame&&this.pGame.html(function(e){let a=e.White,t=e.Black,h=e.Result,c=e.Date,s=[];return/\w+/.test(a)&&s.push(`<p><span dir='auto'>${a}</span>`),/\w+/.test(t)&&s.push(` - <span dir='auto'>${t}</span>`),s.push(` <em>${h}</em>`),/\d+/.test(c)&&s.push(` ${c.match(/\d+/)}</p>`),s.join("")}(this.Tags)),1==this.options.Notes&&this._setLinksNotes(),1==this.options.Child&&(this.chld=this.pChild.find("textarea").pgnbrw({Load:!1,Game:!1,Men:20,Color:2}),this.pChild.find("div.GameNav").css({position:"relative",top:"-0.5em"}),this._setLinksChild(),this.pChild.find(".annCrt:first").show().find("span:first").click())},_setPosition:function(a){let t=function(e){return/ /.test(e)&&(e=e.substr(0,e.indexOf(" "))),e.replace(/\x2f/g,"").replace(/[1-8]/g,e=>" ".repeat(e))}(a);this.pFlds.children().each(function(a){let h=t.charAt(a);if(h&&" "!=h){let a=h.toLowerCase();pieceClass=(h==a?"bl-":"wh-")+f[a],e(this).html(`<div class="Piece ${pieceClass}"></div>`)}else e(this).html("")})},_nextMove:function(){let e,a=this.Links,t=this.LAST_POS_MOVE;return null==t?(this.LAST_POS_MOVE=0,e=a.eq(0)):t<a.length-1&&(e=a.eq(t+1)),this._goToPos(e)},_auto_nextMove:function(){this._nextMove()||(this.brwtimer=this._delay(()=>{this._auto_nextMove()},1e3))},_prevMove:function(){let e,a=this.Links,t=this.LAST_POS_MOVE;null==t?(this.LAST_POS_MOVE=0,e=a.eq(0)):t>0&&(e=a.eq(t-1)),this.pMovLst.scrollTop(0),this._goToPos(e)},_firstMove:function(){let e=this.Links;if(null!=this.LAST_POS_MOVE){e.eq(this.LAST_POS_MOVE).removeClass("onMoveSel");this.pAnnLst.find("div.annCrt").removeClass("annsel"),this.pMovLst.find("a:first");this.pMovLst.scrollTop(0),this.LAST_POS_MOVE=null}this._setPosition(this.FEN_initial)},_lastMove:function(){let e=this.Links;null!=this.LAST_POS_MOVE&&e.eq(this.LAST_POS_MOVE).removeClass("onMoveSel"),this.LAST_POS_MOVE=e.length-1;let a=e.eq(this.LAST_POS_MOVE);this._goToPos(a)},_goToPos:function(e,a){if(!e)return;let t=this.Links,h=parseInt(e.attr("atrMovId")),c=this.Moves[h].FEN;null!=this.LAST_POS_MOVE&&t.eq(this.LAST_POS_MOVE).removeClass("onMoveSel"),this._setPosition(c),this.LAST_POS_MOVE=h;let s=t.eq(h).addClass("onMoveSel"),d=this.pMovLst.offset().top,i=s.offset().top-d;if(a?this.pMovLst.scrollTop(i):i>12*s.height()&&this.pMovLst.animate({scrollTop:"+="+i+"px"}),this.options.Notes){let e=this.pAnnLst;e.find("div.annCrt").removeClass("annsel");let a=e.find(`a[atrMovId='${h}']`).parent().parent().addClass("annsel");if(a.length>0){e.find(".annCrt").css("font-weight","normal"),a.find(".annCrt:first").css("font-weight","bold");let t=a.offset().top-e.offset().top;return e.animate({scrollTop:"+="+t+"px"}),!0}}if(this.options.Child){let e=this.pChild.find(".annCrt"),a=e.find("a[atrMovId='"+h+"']");if(a.length>0)return e.filter(":visible").hide(),a.parent().parent().show().find("span:first").click(),!0}},_setBOARD:function(e){let a=this.x88Board,t=this.sq_king;for(let e=0;e<128;e++)a[e]=0;let h=e.split(/\s+/),c=h[0].split(/\x2f/).reverse().join(""),s=0;c.replace(/[prbnqk]|[1-8]/gi,function(e){if(e<="8")s+=e-0;else{let h=s>>3<<4|7&s;a[h]=l[e],"K"!=e&&"k"!=e||(t[1&l[e]]=h),s++}}),this.to_move=/^w$/i.test(h[1])?0:1,this.castle=0,this.en_pass=-1;let d=h[2].split("");for(let e of d)switch(e){case"K":this.castle|=1;break;case"Q":this.castle|=2;break;case"k":this.castle|=4;break;case"q":this.castle|=8}let i=h[3]||"-";"-"!=i&&(this.en_pass=(e=>16*(e.charCodeAt(1)-49)+e.charCodeAt(0)-97)(i)),this.fifty=h[4]||0,this.nr_move=h[5]||1},_getFEN:function(){let e=[],a=this.x88Board;for(let t=7;t>=0;t--){let h="",c=0;for(let e=0;e<8;e++){let s=a[t<<4|e];s>0?(c&&(h+=c),c=0,h+=b[s]):c++}c&&(h+=c),e.push(h)}let t=[e.join("/")];t[1]=this.to_move?"b":"w";let h="",c=this.castle;return c?(1&c&&(h+="K"),2&c&&(h+="Q"),4&c&&(h+="k"),8&c&&(h+="q")):h="-",t[2]=h,t[3]=this.en_pass>0?k(this.en_pass):"-",t[4]=this.fifty,t[5]=this.nr_move,t.join(" ")},_isAttacked:function(e,a){let t,h,c=this.x88Board,s=4,d=10,i=12,f=8,g=6;if(a){if(!(136&(t=e+15))&&3==c[t])return 1;if(!(136&(t+=2))&&3==c[t])return 1;s++,d++,i++,f++,g++}else{if(!(136&(t=e-15))&&2==c[t])return 1;if(!(136&(t-=2))&&2==c[t])return 1}for(h=0;h<8;h++){if(!(136&(t=e+u[h]))&&c[t]==s)return 1;if(!(136&(t=e+v[h]))&&c[t]==g)return 1}for(h=0;h<4;h++){let a=r[h];for(t=e+a;!(136&t);){let e=c[t];if(e>0){if(e==d||e==i)return 1;break}t+=a}for(t=e+(a=p[h]);!(136&t);){let e=c[t];if(e>0){if(e==f||e==i)return 1;break}t+=a}}return 0},_gen_moves:function(){let e=this.bin_moves=[],a=[],t=this.to_move,h=this.castle,c=this.x88Board,s=this.en_pass;for(let e=0;e<120;e++)136&e||!c[e]||1&c[e]^t||a.push(e);t?12&h&&!this._isAttacked(116,0)&&(4&h&&!(c[117]||c[118]||this._isAttacked(117,0)||this._isAttacked(118,0))&&e.push(24409712),8&h&&!(c[115]||c[114]||c[113]||this._isAttacked(115,0)||this._isAttacked(114,0))&&e.push(41185904)):3&h&&!this._isAttacked(4,1)&&(1&h&&!(c[5]||c[6]||this._isAttacked(5,1)||this._isAttacked(6,1))&&e.push(17040992),2&h&&!(c[3]||c[2]||c[1]||this._isAttacked(3,1)||this._isAttacked(2,1))&&e.push(33817184));for(let h of a){let a=c[h];if(a==(2|t))if(t){if(h>=32)c[h-16]||e.push(100663344|(h<<8|h-16)<<8),h>=96&&!c[h-16]&&!c[h-32]&&e.push(234881072|(h<<8|h-32)<<8);else if(!c[h-16]){let a=(h<<8|h-16)<<8;e.push(218103856|a,184549424|a,150994992|a,83886128|a)}for(let a=15;a<=17;a+=2){let t=h-a;if(!(136&t)){let a=c[t];if(s==t)e.push(251658290|(h<<8|t)<<8);else if(a>0&&!(1&a))if(h<32){let c=(h<<8|t)<<8;e.push(218103856|c|a,184549424|c|a,150994992|c|a,83886128|c|a)}else e.push(100663344|(h<<8|t)<<8|a)}}}else{if(h<96)c[h+16]||e.push(100663328|(h<<8|h+16)<<8),h<24&&!c[h+16]&&!c[h+32]&&e.push(234881056|(h<<8|h+32)<<8);else if(!c[h+16]){let a=(h<<8|h+16)<<8;e.push(201326624|a,167772192|a,134217760|a,67108896|a)}for(var d=15;d<=17;d+=2){let a=h+d;if(!(136&a)){let t=c[a];if(this.en_pass==a)e.push(251658275|(h<<8|a)<<8);else if(1&t)if(h>=96){let c=(h<<8|a)<<8;e.push(201326624|c|t,167772192|c|t,134217760|c|t,67108896|c|t)}else e.push(100663328|(h<<8|a)<<8|t)}}}else{let s=m[a-t];for(let d of s){let s=h;for(;!(136&(s+=d))&&(a!=(6|t)||!this._isAttacked(s,1^t));){let d=c[s];if(d){if(!t&&1&d||t&&!(1&d)){e.push(117440512|(h<<8|s)<<8|a<<4|d);break}break}if(e.push(50331648|(h<<8|s)<<8|a<<4),!(8&a))break}}}}},_makeMove:function(e){let a=this.x88Board,t=this.to_move,h=this.castle,c=e>>24&15,s=e>>16&255,d=e>>8&255,i=a[s],f=a[d];if(6==f||7==f)return 0;if(1!=c&&2!=c){a[d]=i,a[s]=0,15==c&&(a[d+(t?16:-16)]=0);let e=i==(6|t)?d:this.sq_king[t];if(this._isAttacked(e,1^t))return a[s]=i,a[d]=f,15==c&&(t?a[d+16]=2:a[d-16]=3),0;a[s]=i,a[d]=f}switch(this.en_pass>0&&(this.en_pass=-1),c){case 1:t?(a[117]=11,a[118]=7,a[119]=a[116]=0):(a[5]=10,a[6]=6,a[7]=a[4]=0),this.fifty++;break;case 2:t?(a[115]=11,a[114]=7,a[112]=a[116]=0):(a[3]=10,a[2]=6,a[0]=a[4]=0),this.fifty++;break;case 3:a[d]=i,a[s]=0,this.fifty++;break;case 7:case 6:a[d]=i,a[s]=0,this.fifty=0;break;case 12:case 10:case 8:case 4:case 13:case 11:case 9:case 5:a[d]=c,a[s]=0,this.fifty=0;break;case 15:t?a[d+16]=0:a[d-16]=0,a[d]=i,a[s]=0,this.fifty=0;break;case 14:a[d]=i,a[s]=0,this.en_pass=t?d+16:d-16,this.fifty=0}switch(i){case 6:3&h&&(h&=12),this.sq_king[0]=d;break;case 7:12&h&&(h&=3),this.sq_king[1]=d;break;case 10:1&h&&7==s?h^=1:2&h&&0==s&&(h^=2);break;case 11:4&h&&119==s?h^=4:8&h&&112==s&&(h^=8)}switch(f){case 10:1&h&&7==d?h^=1:2&h&&0==d&&(h^=2);break;case 11:4&h&&119==d?h^=4:8&h&&112==d&&(h^=8)}return t&&this.nr_move++,t^=1,this.to_move=t,this.castle=h,1},_legal:function(e){let a,t=_[e[0]];3==e[1].length&&(a=e[1].charAt(2),a=l[a]|this.to_move,e[1]=e[1].replace(/.$/,""));let h=(t<<8|_[e[1]])<<8,c=this.bin_moves;for(let e of c)if((16776960&e)==h&&(!a||e>>24==a)&&this._makeMove(e))return!0;return!1},_san_legal:function(e){this._gen_moves();let a,t,h,d=["",""];if("O-O-O"==e||"0-0-0"==e)return this.to_move?this._legal(["e8","c8"]):this._legal(["e1","c1"]);if("O-O"==e||"0-0"==e)return this.to_move?this._legal(["e8","g8"]):this._legal(["e1","g1"]);(t=e.match(/=?[QRBN]$/))&&(a=e.charAt(e.length-1),e=e.replace(t,"")),d[1]=e.substr(e.length-2,2);let i=!1;if((t=(e=e.replace(/..$/,"")).match(/x$/i))&&(i=!0,e=e.replace(t,"")),a&&i)return d[0]=e.charAt(0)+(this.to_move?"2":"7"),d[1]+=a,this._legal(d);if(a)return d[0]=d[1].charAt(0)+(this.to_move?"2":"7"),d[1]+=a,this._legal(d);let f,g,n=this.x88Board;if(/^[KQRBN]/.test(e)){if(h=e.charAt(0),f=c[h],e=e.replace(/^./,""),/^[a-h][1-8]/.test(e))return d[0]=e,this._legal(d);this.to_move&&(h=h.toLowerCase()),h=l[h],g=f[d[1]];for(let a of g)if(n[_[a]]==h&&(!e||e==a.charAt(0)||e==a.charAt(1))&&(d[0]=a,this._legal(d)))return!0}g=s[this.to_move][d[1]],h=this.to_move?3:2;let o=i?e.charAt(0):d[1].charAt(0);for(let e of g)if(n[_[e]]==h&&e.charAt(0)==o&&(d[0]=e,this._legal(d)))return!0;return 0},_extract_pgn:function(){let e,a,h,c=this.element.val();if(!c)return;if(a=c.match(B)){for(h of a){h.match(M);this.Tags[RegExp.$1]=RegExp.$2}c=c.replace(B,"")}for((a=(c=c.replace(/^\s+/,"")).match(y))&&(c=c.replace(a[0],""),this.Tags.Result||(this.Tags.Result=a[0].trim())),e=/^\s*\{[^\}]*\}/;a=c.match(e);)this.in_comm+=" "+a[0].replace(/^\s*\{|\}$/g,""),c=c.replace(a,"");let s=0,d=!1,i=(c=c.replace(/^\s+/,"")).length;for(c=c.replace(/\.\s+\.\.\./g,"...");i>0&&!d;){if((a=(c=c.replace(/^[ |\t]+/,"")).match(/^\d+\.{1,3}\s*/))&&0==(c=c.replace(a[0],"")).length){this.errors=" MOVESECTION încheiat cu "+a+". ",d=!0;break}if((a=c.match(A))||(a=c.match(w))){if(/^\d/.test(a[0])){this.errors=" SAN început cu o cifră: "+a+". ",d=!0;break}(h=new o).SAN=a[0],this.Moves[s++]=h,c=(c=c.replace(a[0],"")).replace(/^\s+/,"")}if((a=c.match($))&&(this.Moves[s-1].mark=a[0],c=(c=c.replace(a,"")).replace(/^\s+/,"")),/^\$([7-9]|\d{2,3})/.test(c)&&(this.Moves[s-1].NAG=RegExp.$1,a="$"+RegExp.$1,c=(c=c.replace(a,"")).replace(/^\s+/,"")),/^\$([1-6]?)/.test(c)&&(this.Moves[s-1].mark+=t[parseInt(RegExp.$1)],a="$"+RegExp.$1,c=(c=c.replace(a,"")).replace(/^\s+/,"")),"{"==c.charAt(0)){if(!(a=W(c,"{","}"))){this.errors=" Există acolade nepereche. ",d=!0;break}this.Moves[s-1].comment+=a+" ",c=(c=c.replace(a,"")).replace(/^\{\}\s+/,"")}if("("==c.charAt(0)){if(!(a=W(c,"(",")"))){this.errors=" Există paranteze rotunde nepereche. ",d=!0;break}this.Moves[s-1].variant.push(a),c=(c=c.replace(a,"")).replace(/^\(\)\s+/,"")}if(";"==c.charAt(0)&&(a=c.match(/^.+[\r|\n]/),c=c.replace(a[0],""),a=a[0].substring(1),s>0?this.Moves[s-1].comment+=a+" ":this.in_comm+=a),i==c.length){d=!0,this.errors=" eroare PGN pe la mutarea "+parseInt(s/2);break}i=c.length}d&&alert(this.errors)},_setLinks:function(){let e=this.Moves,a=!1,t=[];this.to_move&&t.push(`<span class="nrMove">${this.nr_move}...</span>`);let h=0;for(let c of e){let e=c.SAN;if(!this._san_legal(e)){a=!0;break}{let a=this._getFEN(),s=/ w /.test(a);c.FEN=a,s||t.push(`<span class="nrMove">${this.nr_move}.</span>`),t.push(`<a href='' class="onMove" atrMovId="${h}">\n                      ${e}<span class="moveMark">${c.mark}</span></a>`),t.push(s?"<br>":"&nbsp;"),h++}}this.pMovLst.html(t.join("")),a&&alert("Mutare eronată (pe la "+this.nr_move+")")},_setLinksNotes:function(){let t=this.Moves,c=[];this.in_comm&&c.push(`<div class="Cinit">\n                               ${h(this.in_comm)}</div>`);let s=0;for(let e of t){let{SAN:t,FEN:d,mark:i,NAG:f,variant:g,comment:n}=e;if(f||g.length>0||n){let e=C(d);c.push(`<div class="annCrt">\n                          <p>${e}<a href='' atrMovId="${s}">\n                                         ${t}${i}</a></p>`),f&&c.push(`<div class="annNAG">${a[f]}</div>`);let o=[];for(let e of g)o.push(`<div>${h(e)}</div>`);o.length>0&&c.push(`<div>${o.join("")}</div>`),n&&c.push(`<div>${h(n)}</div>`),c.push("</div>")}s++}this.pAnnLst.html(c.join(""));let d=this;this.pAnnLst.click(function(a){a.preventDefault();var t=e(a.target);if(t.is("a"))d.pMovLst.scrollTop(0),d._goToPos(t,!0);else if(t.is("span[data-variant]")){e(t).siblings().css("font-weight","normal").end().css("font-weight","bold")}})},_setLinksChild:function(){let t=this.Moves,h=[],c=0;for(let e of t){if(e.variant.length>0){let t=e.SAN,s=e.FEN,d=e.mark,i=e.NAG,f=e.variant,g=C(s);h.push(`<div class="annCrt" style="display:none">\n                          <p>${g}<a href='' atrMovId="${c}">\n                                         ${t}${d}</a></p>`),i&&h.push(`<div class="annNAG">${a[i]}</div>`);for(let e of f){let a=e.match(/^\{.*:(.*?)\}\s*(.*)\$/),t=a[1],s=a[2].replace(/\. /g,"."),d=s.match(/^[^ ]*/),i=`[FEN "${this.Moves[c-1].FEN}"] ${s} *`;h.push(`<span data-variant='${i}'>${d}</span>`,`<span>(${t})</span>&nbsp;&nbsp;`)}h.push("</div>")}c++}this.pChild.find("div.Grid1").append(e(h.join("")));let s=this;this.pChild.click(function(a){a.preventDefault();var t=e(a.target);if(t.is("a"))s.pMovLst.scrollTop(0),s._goToPos(t,!0);else if(t.is("span[data-variant]")){let a=e(t);a.siblings().css("font-weight","normal").end().css("font-weight","bold"),s.pChild.find("textarea").val(a.data("variant")),s.chld.pgnbrw()}})},allMovesTable:function(){let e={N:{},K:{},B:{},R:{},Q:{}},a=this.x88Board;for(let e=0;e<128;e++)a[e]=0;this.to_move=0,this.castle=0;for(let t=4;t<=12;t+=2){let h=b[t];for(let c in _){a[_[c]]=t,this._gen_moves();let s=this.bin_moves,d=[];for(let e=0,a=s.length;e<a;e++){let a=s[e]>>8&255;d.push(k(a))}e[h][c]=d,a[_[c]]=0}}Object.keys(e).forEach(function(a){console.log(`const ${a}_Moves=${JSON.stringify(e[a])};`)})},perft:function(e){let a=e||this.Tags.FEN,t=0;this._setBOARD(a),this._gen_moves();for(let e of this.bin_moves)this._makeMove(e)&&(t++,this._setBOARD(a));console.log(`[FEN "${a}"]: ${t} mutări legale`)},goToMove:function(e,a){let t=this.Links;null!=this.LAST_POS_MOVE&&t.eq(this.LAST_POS_MOVE).removeClass("oneMoveSel"),this.LAST_POS_MOVE=1==a?2*(e-1):2*e-1;let h=t.eq(this.LAST_POS_MOVE);this._goToPos(h,!0)}})}(jQuery);
